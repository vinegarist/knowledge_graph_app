# AI驱动的症状诊断系统

## 概述

AI驱动的症状诊断系统是基于大语言模型（Ollama）的智能医疗诊断工具，结合医疗知识图谱数据，为用户提供专业的症状分析和疾病诊断建议。

## 主要特性

### 1. AI智能诊断
- **基于大语言模型**：使用Ollama本地模型进行智能诊断
- **知识图谱结合**：结合医疗知识图谱数据进行准确分析
- **专业医疗提示**：使用专业的医疗系统提示词
- **置信度分析**：提供诊断结果的置信度评估

### 2. 交互式诊断
- **智能问题生成**：AI自动生成有针对性的诊断问题
- **症状提取**：从用户回答中智能提取症状信息
- **渐进式诊断**：通过多轮对话逐步完善诊断结果
- **动态更新**：实时更新症状列表和诊断结果

### 3. 用户界面
- **现代化设计**：使用React和Tailwind CSS构建
- **响应式布局**：支持桌面和移动设备
- **实时反馈**：加载状态和错误提示
- **统计信息**：显示系统统计和性能指标

## 技术架构

### 后端架构
```
ai_symptom_diagnosis.py          # AI诊断引擎核心
ai_symptom_diagnosis_routes.py   # API路由定义
medical_ai.py                    # 基础AI服务
```

### 前端架构
```
AISymptomDiagnosisPage.jsx      # AI诊断页面组件
App.jsx                         # 主应用导航
```

### API接口

#### 1. 基本诊断
```http
POST /api/ai-symptom-diagnosis/diagnose
Content-Type: application/json

{
  "symptoms": ["咳嗽", "发热", "头痛"]
}
```

#### 2. 交互式诊断
```http
POST /api/ai-symptom-diagnosis/interactive/start
Content-Type: application/json

{
  "symptoms": ["咳嗽", "喉咙痛"]
}
```

#### 3. 回答问题
```http
POST /api/ai-symptom-diagnosis/interactive/answer
Content-Type: application/json

{
  "answers": {
    "q_0": "是的，我有这些症状",
    "q_1": "症状持续了3天"
  },
  "current_symptoms": ["咳嗽", "喉咙痛"]
}
```

#### 4. 统计信息
```http
GET /api/ai-symptom-diagnosis/statistics
```

#### 5. 症状列表
```http
GET /api/ai-symptom-diagnosis/symptoms
```

## 核心功能

### 1. AI诊断引擎 (AISymptomDiagnosisEngine)

#### 主要方法
- `diagnose_by_symptoms(symptoms)`: 基于症状进行AI诊断
- `interactive_diagnosis(initial_symptoms)`: 启动交互式诊断
- `answer_questions(answers, current_symptoms)`: 处理用户回答
- `_call_ollama_ai(prompt, system_prompt)`: 调用Ollama模型

#### 诊断流程
1. **症状输入**：用户输入初始症状
2. **知识图谱查询**：基于症状查找相关疾病
3. **AI分析**：使用大语言模型分析症状-疾病关系
4. **结果生成**：生成诊断报告和建议

### 2. 交互式诊断流程

#### 第一阶段：初始诊断
1. 用户输入症状
2. 系统进行初步诊断
3. AI生成针对性问题

#### 第二阶段：问题回答
1. 用户回答AI生成的问题
2. AI从回答中提取新症状
3. 更新症状列表

#### 第三阶段：最终诊断
1. 基于完整症状重新诊断
2. 生成最终诊断报告
3. 提供医疗建议

### 3. AI提示词设计

#### 诊断提示词
```
你是一个专业的医疗AI助手，专门进行症状诊断。请基于提供的症状和疾病信息，进行专业的诊断分析。

诊断要求：
1. 分析症状与疾病的匹配程度
2. 考虑症状的严重程度和组合
3. 提供可能的诊断结果和置信度
4. 建议进一步的检查或注意事项
5. 始终提醒用户咨询专业医生
```

#### 问题生成提示词
```
你是一个专业的医疗AI助手，正在进行交互式诊断。请基于患者的症状和可能的疾病，生成有针对性的问题来进一步了解病情。

问题要求：
1. 问题要具体且有针对性
2. 避免重复已知症状
3. 重点关注关键症状
4. 问题要简洁明了
5. 每次最多生成3个问题
```

#### 症状提取提示词
```
你是一个医疗AI助手，请从患者的回答中提取症状信息。

要求：
1. 只提取明确的症状描述
2. 忽略非症状信息
3. 用简洁的词语描述症状
4. 如果有多个症状，用逗号分隔
```

## 部署和使用

### 1. 环境要求
- Python 3.8+
- Node.js 16+
- Ollama服务运行中
- 医疗知识图谱数据

### 2. 安装依赖
```bash
# 后端依赖
pip install -r requirements_ai.txt

# 前端依赖
cd frontend/knowledge-graph-frontend
npm install
```

### 3. 启动服务
```bash
# 启动后端
python start_system.py

# 启动前端
cd frontend/knowledge-graph-frontend
npm run dev
```

### 4. 访问系统
- 前端地址：http://localhost:5174
- 后端API：http://localhost:5000
- 选择"AI诊断"标签页

## 使用示例

### 1. 基本诊断
1. 在症状输入框中输入症状（如"咳嗽"、"发热"）
2. 点击"AI智能诊断"按钮
3. 查看AI生成的诊断分析

### 2. 交互式诊断
1. 输入初始症状
2. 点击"交互式诊断"按钮
3. 回答AI生成的问题
4. 查看逐步完善的诊断结果

### 3. 症状管理
- 点击常用症状标签快速添加
- 使用删除按钮移除不需要的症状
- 支持键盘回车快速添加

## 安全性和免责声明

### 1. 医疗免责声明
- 本系统提供的诊断结果仅供参考
- 不能替代专业医生的诊断
- 如有疑问或症状严重，请及时就医

### 2. 数据安全
- 所有数据在本地处理
- 不向外部服务器发送敏感信息
- 支持数据加密和隐私保护

### 3. 系统限制
- 诊断准确性依赖于知识图谱数据质量
- AI模型可能存在局限性
- 建议结合专业医疗意见

## 性能优化

### 1. 缓存机制
- 症状-疾病映射缓存
- 知识图谱数据缓存
- API响应缓存

### 2. 并发处理
- 支持多用户同时使用
- 异步AI模型调用
- 请求队列管理

### 3. 错误处理
- 网络异常处理
- AI模型调用失败处理
- 用户输入验证

## 未来扩展

### 1. 功能扩展
- 支持图片症状识别
- 集成更多医疗数据源
- 添加治疗方案推荐

### 2. 技术升级
- 支持更多AI模型
- 实时语音交互
- 移动端应用

### 3. 数据增强
- 扩展知识图谱规模
- 添加更多疾病类型
- 支持多语言诊断

## 总结

AI驱动的症状诊断系统成功地将大语言模型与医疗知识图谱相结合，为用户提供了智能、专业、易用的症状诊断服务。系统不仅具备强大的AI分析能力，还通过交互式诊断提供了个性化的医疗建议，为用户的健康管理提供了有力支持。 
# 症状诊断系统使用说明

## 概述

症状诊断系统是一个独立的医疗诊断工具，可以根据用户输入的症状分析可能的疾病，并提供交互式诊断功能。

## 功能特性

### 1. 基本症状诊断
- **症状输入**：支持输入多个症状
- **疾病匹配**：根据症状找到可能的疾病
- **匹配度计算**：计算症状与疾病的匹配程度
- **结果排序**：按匹配度对疾病进行排序

### 2. 交互式诊断
- **逐步询问**：根据初步诊断结果进一步询问症状
- **动态更新**：根据新症状更新诊断结果
- **智能推荐**：推荐需要确认的重要症状

### 3. 疾病详情查询
- **症状列表**：查看疾病的所有相关症状
- **实体信息**：获取疾病的详细信息
- **统计信息**：查看症状-疾病映射的统计信息

## API接口

### 1. 基本诊断
```http
POST /api/symptom-diagnosis/diagnose
Content-Type: application/json

{
  "symptoms": ["头痛", "发烧", "流鼻涕"],
  "min_match_ratio": 0.3
}
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "symptoms": ["头痛", "发烧", "流鼻涕"],
    "possible_diseases": [
      {
        "disease": "感冒",
        "matched_symptoms": ["头痛", "发烧", "流鼻涕"],
        "total_symptoms": 10,
        "match_ratio": 0.8,
        "score": 2.4
      }
    ],
    "further_questions": [
      {
        "disease": "感冒",
        "question": "您是否还有以下症状？",
        "symptoms": ["咽痛", "鼻塞", "打喷嚏"],
        "reason": "这些症状在感冒中比较常见"
      }
    ]
  }
}
```

### 2. 交互式诊断开始
```http
POST /api/symptom-diagnosis/interactive/start
Content-Type: application/json

{
  "symptoms": ["咳嗽", "喉咙痛"]
}
```

### 3. 回答交互式问题
```http
POST /api/symptom-diagnosis/interactive/answer
Content-Type: application/json

{
  "answers": {
    "q_0": ["咽痛"],
    "q_1": ["发烧"]
  },
  "current_symptoms": ["咳嗽", "喉咙痛"]
}
```

### 4. 获取疾病详情
```http
GET /api/symptom-diagnosis/disease/感冒
```

### 5. 获取统计信息
```http
GET /api/symptom-diagnosis/statistics
```

### 6. 获取可用症状列表
```http
GET /api/symptom-diagnosis/symptoms
```

### 7. 获取可用疾病列表
```http
GET /api/symptom-diagnosis/diseases
```

## 前端组件使用

### 1. 导入组件
```jsx
import SymptomDiagnosis from './components/SymptomDiagnosis';
```

### 2. 使用组件
```jsx
function App() {
  return (
    <div>
      <SymptomDiagnosis />
    </div>
  );
}
```

## 使用流程

### 1. 基本诊断流程
1. **输入症状**：在症状输入框中输入症状，或从可用症状列表中选择
2. **开始诊断**：点击"开始诊断"按钮
3. **查看结果**：系统显示可能的疾病列表，按匹配度排序
4. **进一步确认**：根据建议的问题进一步确认症状

### 2. 交互式诊断流程
1. **输入初始症状**：输入已知的症状
2. **开始交互诊断**：点击"交互式诊断"按钮
3. **回答问题**：根据系统提示的问题选择相关症状
4. **提交答案**：点击"提交答案"按钮
5. **查看更新结果**：系统根据新信息更新诊断结果
6. **重复步骤3-5**：直到获得满意的诊断结果

## 技术实现

### 1. 症状-疾病映射
- 从知识图谱中提取症状-疾病关系
- 构建双向映射缓存
- 支持模糊匹配和精确匹配

### 2. 匹配算法
- **匹配度计算**：匹配症状数 / 疾病总症状数
- **综合评分**：匹配症状数 × 匹配度
- **阈值过滤**：只返回匹配度超过阈值的疾病

### 3. 交互式诊断
- **问题生成**：根据疾病症状生成询问问题
- **答案处理**：动态更新症状列表
- **结果更新**：重新计算匹配度

## 配置参数

### 1. 匹配阈值
- `min_match_ratio`：最小匹配比例，默认0.3
- 取值范围：0.0-1.0
- 建议值：0.2-0.5

### 2. 结果数量
- 默认返回前10个匹配疾病
- 可通过修改代码调整

### 3. 问题数量
- 交互式诊断最多返回5个问题
- 每个疾病最多询问3个症状

## 测试

### 1. 运行测试脚本
```bash
cd knowledge_graph_app
python test_symptom_diagnosis_system.py
```

### 2. 测试用例
- 基本症状诊断
- 交互式诊断
- 疾病详情查询
- 统计信息获取
- 复杂场景测试

## 注意事项

### 1. 数据依赖
- 依赖知识图谱中的症状-疾病关系数据
- 确保CSV文件包含完整的症状信息

### 2. 性能考虑
- 症状-疾病映射在启动时构建
- 使用缓存提高查询性能
- 大量症状时考虑分批处理

### 3. 准确性
- 诊断结果仅供参考
- 不能替代专业医疗诊断
- 建议结合其他医疗信息

## 扩展功能

### 1. 症状权重
- 根据症状重要性设置权重
- 提高关键症状的匹配度

### 2. 症状组合
- 支持症状组合模式识别
- 考虑症状之间的关联性

### 3. 机器学习
- 使用NLP技术改进症状识别
- 基于历史数据优化匹配算法

### 4. 多语言支持
- 支持症状的多语言表达
- 同义词和近义词处理

## 故障排除

### 1. 诊断引擎未初始化
- 检查AI助手是否正确初始化
- 确认知识图谱数据已加载

### 2. 找不到匹配疾病
- 降低匹配阈值
- 检查症状名称是否正确
- 确认知识图谱包含相关数据

### 3. 性能问题
- 检查缓存是否正常工作
- 考虑优化搜索算法
- 减少同时处理的症状数量

## 更新日志

### v1.0.0 (2025-01-XX)
- 初始版本发布
- 基本症状诊断功能
- 交互式诊断功能
- 疾病详情查询
- 统计信息功能 